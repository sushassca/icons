<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>.icons</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <!-- STYLES -->
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="master.css">
</head>

<body>
  <div>

    <button id='request'>
      Request Camera
    </button>
    <button id='start'>
      Start Recording
    </button>
    <button id='stop'>
      Stop Recording
    </button>
    <ul id='ul' style="color:black">
      Downloads List:
    </ul>

  </div>
  <video id='video' style="width:400px;background-color:red;"  autoplay></video>
  <!-- SCRIPTS -->

  <script type="text/javascript">
  var video, reqBtn, startBtn, stopBtn, ul, stream, recorder;
  video = document.getElementById('video');
  reqBtn = document.getElementById('request');
  startBtn = document.getElementById('start');
  stopBtn = document.getElementById('stop');
  ul = document.getElementById('ul');
  reqBtn.onclick = requestVideo;
  startBtn.onclick = startRecording;
  stopBtn.onclick = stopRecording;
  startBtn.disabled = true;
  ul.style.display = 'none';
  stopBtn.disabled = true;

  function requestVideo() {
    navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
      })
      .then(stm => {
        stream = stm;
        reqBtn.style.display = 'none';
        startBtn.removeAttribute('disabled');
        video.srcObject = stream;
      }).catch(e => alert(e));
  }

  function startRecording() {
  
    function record(length,stream) {
        var recorder = new window.MediaRecorder(stream);

        recorder.ondataavailable = function(event) {
            if (recorder.state == 'recording') {
                var blob = new window.Blob([event.data], {
                    type: 'audio/ogg'
                });

                // use the created blob

                recorder.stop();
            }
        };

        recorder.onstop = function() {
            recorder = null;
        };

        recorder.start(length);
    }

    recorder.start();
    stopBtn.removeAttribute('disabled');
    startBtn.disabled = true;
  }


  function stopRecording() {
    recorder.ondataavailable = e => {
      ul.style.display = 'block';
      var a = document.createElement('a'),
        li = document.createElement('li');
      a.download = ['video_', (new Date() + '').slice(4, 28), '.webm'].join('');
      a.href = URL.createObjectURL(e.data);
      a.textContent = a.download;
      li.appendChild(a);
      ul.appendChild(li);
    };
    recorder.stop();
    startBtn.removeAttribute('disabled');
    stopBtn.disabled = true;
  }
  </script>
</body>

</html>
